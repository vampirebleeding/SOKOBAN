#ifndef LOOP_CPP
#define LOOP_CPP

#include "loop.h"


void loop(int* out,char* name,int* scores)
{   
    
    //关卡 level == 0 表示第一关, level == 1 表示第二关,以此类推
    int level = 0;           
    
    //人的初始坐标
    int XOfMan = 0;          
    int YOfMan = 0;
    
    //打开菜单
    bool menutool = false;   
    
    //排行榜得分
    *scores = 0;             
    
    
    // 1 打开选择关卡界面
    chooseLevel(&level);     //define in "game.cpp"

    
    do {

        
        //status == 1表示通关
        int status = 1;  
        

        //2 游戏地图
        int map[TOTAL_LEVEL][LINE][COLUMN] = {
            //关卡1
            {
                {},                              
                {},
                {0,0,0,0,0,1,1,1,1,0,0,0,0,0,0},
                {0,0,0,0,0,1,2,6,1,1,0,0,0,0,0},
                {0,0,0,0,1,1,4,3,2,1,0,0,0,0,0},
                {0,0,0,0,1,6,4,4,6,1,0,0,0,0,0},
                {0,0,0,0,1,6,2,4,6,1,0,0,0,0,0},
                {0,0,0,0,1,6,2,6,6,1,0,0,0,0,0},
                {0,0,0,0,1,1,1,1,1,1,0,0,0,0,0},
                {},
                {},
                {}
            },
            //关卡2
            {
                {},
                {},
                {0,0,0,0,1,1,1,0,0,0,0,0,0,0,0},
                {0,0,0,0,1,2,1,1,1,1,0,0,0,0,0},
                {0,0,0,0,1,6,4,6,2,1,0,0,0,0,0},
                {0,0,0,0,1,6,4,4,6,1,0,0,0,0,0},
                {0,0,0,0,1,6,4,3,2,1,0,0,0,0,0},
                {0,0,0,0,1,2,1,1,1,1,0,0,0,0,0},
                {0,0,0,0,1,1,1,0,0,0,0,0,0,0,0},
                {},
                {},
                {}
            },

            //关卡3
           {
                {},
                {},
                {0,0,0,0,0,1,1,1,0,0,0,0,0,0,0},
                {0,0,0,0,1,2,2,2,1,0,0,0,0,0,0},
                {0,0,0,0,1,6,4,6,1,0,0,0,0,0,0},
                {0,0,0,0,1,4,4,4,1,0,0,0,0,0,0},
                {0,0,0,0,1,6,4,3,1,0,0,0,0,0,0},
                {0,0,0,0,1,6,4,6,1,0,0,0,0,0,0},
                {0,0,0,0,1,2,2,2,1,0,0,0,0,0,0},
                {0,0,0,0,1,1,1,1,1,0,0,0,0,0,0},
                {},
                {}
            },
            {
                {},
                {0,0,0,0,0,1,1,1,1,1,0,0,0,0,0},
                {0,0,0,0,1,1,2,6,2,1,1,0,0,0,0},
                {0,0,0,0,1,2,4,4,4,2,1,0,0,0,0},
                {0,0,0,0,1,6,4,3,4,6,1,0,0,0,0},
                {0,0,0,0,1,2,4,4,4,2,1,0,0,0,0},
                {0,0,0,0,1,1,2,6,2,1,1,0,0,0,0},
                {0,0,0,0,0,1,1,1,1,1,0,0,0,0,0},
                {},
                {},
                {},
                {}
            },
            {
                {},
                {},
                {0,0,0,0,1,1,1,1,1,1,0,0,0,0,0},
                {0,0,0,0,1,6,6,2,6,1,1,0,0,0,0},
                {0,0,0,0,1,6,1,6,6,2,1,0,0,0,0},
                {0,0,0,0,1,6,1,4,6,1,1,0,0,0,0},
                {0,0,0,0,1,6,2,4,2,6,1,0,0,0,0},
                {0,0,0,0,1,6,6,4,4,6,1,0,0,0,0},
                {0,0,0,0,1,1,6,6,3,6,1,0,0,0,0},
                {0,0,0,0,0,1,1,1,1,1,1,0,0,0,0},
                {},
                {}
            },
            {
                {0,0,0,0,1,1,1,1,1,1,1,0,0,0,0},
                {0,1,1,1,1,6,6,6,6,6,1,0,0,0,0},
                {0,1,6,6,6,2,1,1,1,6,1,0,0,0,0},
                {0,1,6,1,6,1,6,6,6,6,1,1,0,0,0},
                {0,1,6,1,6,4,6,4,1,2,6,1,0,0,0},
                {0,1,6,1,6,6,5,6,6,1,6,1,0,0,0},
                {0,1,6,2,1,4,6,4,6,1,6,1,0,0,0},
                {0,1,1,6,6,6,6,1,6,1,6,1,1,1,0},
                {0,0,1,6,1,1,1,2,6,6,6,6,3,1,0},
                {0,0,1,6,6,6,6,6,1,1,6,6,6,1,0},
                {0,0,1,1,1,1,1,1,1,1,1,1,1,1,0},
                {}
            },          
            {
				{},
                {},
                {},
                {0,0,1,1,1,1,0,0,1,1,1,1,1,0,0},
                {0,1,1,6,6,1,0,0,1,6,6,6,1,0,0},
                {0,1,6,4,6,1,1,1,1,4,6,6,1,0,0},
                {0,1,6,6,4,2,2,2,2,6,4,6,1,0,0},
                {0,1,1,6,6,6,6,1,6,3,6,1,1,0,0},
                {0,0,1,1,1,1,1,1,1,1,1,1,0,0,0},
                {},
                {},
				{}
            },   
            {
                {0,0,1,1,1,1,1,1,1,1,1,0,0,0,0},
                {0,0,1,6,6,6,1,1,6,6,1,1,1,1,0},
                {0,0,1,6,4,6,6,6,6,6,6,6,6,1,0},
                {0,0,1,1,4,1,1,1,6,1,1,6,6,1,0},
                {0,0,1,6,6,1,1,6,5,6,1,6,1,1,0},
                {0,0,1,6,4,2,2,2,2,2,2,6,1,0,0},
                {0,1,1,6,1,1,1,6,2,6,1,6,1,0,0},
                {0,1,6,6,6,6,6,4,1,1,1,4,1,0,0},
                {0,1,6,6,6,6,6,6,6,6,4,3,1,0,0},
                {0,1,1,1,1,1,4,1,6,1,1,1,1,0,0},
                {0,0,0,0,0,1,6,6,6,1,0,0,0,0,0},
                {0,0,0,0,0,1,1,1,1,1,0,0,0,0,0}
            },
            {
                {0,0,0,0,0,0,1,1,1,1,1,1,1,1,1},
                {0,0,0,0,0,0,1,6,6,6,6,6,6,6,1},
                {0,0,0,0,0,0,1,6,1,6,1,6,1,6,1},
                {0,0,0,0,0,0,1,6,6,4,6,4,1,6,1},
                {1,1,1,1,1,1,1,6,6,6,4,6,6,6,1},
                {1,2,2,1,6,6,1,1,6,4,6,4,1,6,1},
                {1,2,2,6,6,6,1,1,6,4,6,4,6,6,1},
                {1,2,2,1,6,6,1,1,6,1,1,1,1,1,1},
                {1,2,2,1,6,1,6,4,6,4,6,1,0,0,0},
                {1,2,2,6,6,6,6,6,4,6,6,1,0,0,0},
                {1,6,6,1,1,1,6,6,3,1,1,1,0,0,0},
                {1,1,1,1,0,1,1,1,1,1,0,0,0,0,0}
                },
            {
               {},
               {1,1,1,1,1,1,0,0,0,1,1,1,1,1,0},
               {1,6,6,6,6,1,1,1,0,1,6,6,2,1,0},
               {1,6,6,4,6,4,6,1,0,1,2,2,2,1,0},
               {1,6,1,6,6,4,6,1,1,1,6,6,2,1,0},
               {1,6,6,4,4,4,6,6,6,4,6,3,2,1,0},
               {1,1,1,6,6,4,6,6,4,1,6,6,2,1,0},
               {0,0,1,6,6,4,1,4,6,1,2,2,2,1,0},
               {0,0,1,1,6,6,6,6,6,1,6,6,2,1,0},
               {0,0,0,1,1,1,1,1,1,1,1,1,1,1,0},
               {},
               {}
            }
        };


        //3 打开窗口,并设置窗口大小
        setWindowSize();                                               //define in "game.cpp"
        

        //4 插入对应关卡的背景图
        setBackground(&level);                                         //define in "game.cpp"
        

        //5 插入其他所需图片
        addPictures(&level, &XOfMan, &YOfMan, map);                    //define in "game.cpp"


        //6 游戏主程序
        getKey(&level, map, &XOfMan, &YOfMan,&status,out,&menutool);   //define in "game.cpp"
        

        //7 若通过一个关卡则加分:
        if (status == 1) {
            *scores = *scores + level;
        }

    } while (!*out);

    return;
}
    
#endif